<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<style type="text/css">
			[v-cloak] {
				display: none;
			}
			
			.p-show {
				color: #f96161;
				font-size: 12px;
				height: 32px;
				text-align: center;
				background: #f2f2f2;
				padding-top: 7px;
			}
			
			.p-show3 {
				color: #f96161;
				font-size: 12px;
				height: 15px;
				text-align: center;
				background: #f7f7f7;
			}
			
			.p-smg {
				color: #999999;
				font-size: 14px;
				margin-left: 10px;
				padding-top: 5px;
			}
			
			.p-show1 {
				height: 1px;
				background: #E4E4E4;
				margin-left: 12px;
			}
			
			.img-people {
				width: 50px;
				height: 50px;
				border-radius: 50%;
				margin-left: 10px;
				margin-top: 0px;
			}
			
			.userNameclass {
				color: #333333;
				padding-left: 10px;
				margin-top: 10px;
				font-size: 14px;
			}
			
			.p-show2 {
				height: 5px;
				background: #E4E4E4;
			}
			
			.weui-btn_blue {
				background-color: #00CFBD;
				color: white;
				text-align: center;
				height: 50px;
				padding-top: 15px;
				margin-top: 7px;
				margin-left: 3%;
				margin-right: 3%;
				margin-bottom: 7px;
			}
			
			.mui-ellipsis {
				font-size: 16px;
				color: black;
				margin-top: 10px;
			}
			
			.mui-radio input[type=radio]:before {
				font-size: 20px;
				line-height: 1.4;
				content: '\e411';
			}
			
			.mui-checkbox input[type=checkbox]:checked:before,
			.mui-radio input[type=radio]:checked:before {
				font-size: 20px;
				line-height: 1.4;
				color: #00CFBD;
			}
			
			.selectUserName {
				font-size: 14px;
				color: #666666;
				padding-top: 12px;
			}
			
			.mui-input-group::before {
				position: absolute;
				top: 0;
				right: 0;
				left: 10px;
				height: 0px;
				content: '';
				-webkit-transform: scaleY(.5);
				transform: scaleY(.5);
				background-color: #c8c7cc;
			}
			
			.mui-input-group .mui-input-row::after {
				position: absolute;
				right: 0;
				bottom: 0;
				left: 15px;
				height: 0px;
				content: '';
				-webkit-transform: scaleY(.5);
				transform: scaleY(.5);
				background-color: #c8c7cc;
			}
			
			.mui-input-group::after {
				position: absolute;
				right: 0;
				bottom: 0;
				left: 0;
				height: 0px;
				content: '';
				-webkit-transform: scaleY(.5);
				transform: scaleY(.5);
				background-color: #c8c7cc;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="background-color:#00CFBD;">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color:#ffffff"></a>
			<h1 class="mui-title" style="color: white;">关联学生</h1>
		</header>
		<div id='userBusData' class="mui-content mui-fullscreen" style="background: white;">
			<p class="p-show" v-show="userStuList.length==0">
				<-------您还没有关联学生,请先关联学生!------->
			</p>
			<p class="p-smg">账号信息</p>
			<p class="p-show1"></p>
			<a href="javascript:;">
				<img class="mui-media-object mui-pull-left img-people" src="../../img/login/headImg.png">
				<div class="mui-media-body">
					<p class="mui-ellipsis userNameclass">{{peopleMsg.utname}}</p>
					<p class="mui-ellipsis userNameclass">{{peopleMsg.uid}}</p>
				</div>
			</a>
			<p class="p-show2"></p>
			<p class="p-smg">请关联套餐对应的学生</p>
			<div v-if="orderList.length == 0" v-cloak style="text-align: center;margin:40% auto;">
				<img src="../../img/homeSchool/noData.png" style="width: 200px;" />
			</div>
			<div v-else v-cloak class="mui-scroll">
				<div class="mui-row" style="margin-bottom: 81px;">
					<div id="" v-for="(userBusModel,index) in orderList">
						<p class="p-show1"></p>
						<a class="mui-content-padded userNameclass">{{userBusModel.cname}}</a>
						<form class="mui-input-group" v-for="(stuModel,index1) in userBusModel.stuList">
							<div class="mui-input-row mui-radio mui-left" @tap.stop="clickStu(userBusModel,stuModel)">
								<label class="selectUserName">{{stuModel.schname}}{{stuModel.grdname}}{{stuModel.clsname}}{{stuModel.stuname}}({{stuModel.sexName}})</label>
								<input v-if="stuModel.selectStu==0" name="radio1" type="radio">
								<input v-else="" name="radio1" type="radio" checked>
							</div>
						</form>
					</div>
				</div>
			</div>

			<nav class="mui-bar mui-bar-tab" style="margin-top: 5px;">
				<p class="p-show3">*如果没有您要选的学生请联系班主任</p>
				<p @click="sureFunc" class="weui-btn weui-btn_blue">确定</p>
			</nav>
		</div>
		<script type="text/javascript" src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/utils/vue.js"></script>
		<!--加密-->
		<script src="../../js/libs/RSA/Barrett.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/libs/RSA/BigInt.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/libs/RSA/RSA.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/utils/RSAEncrypt.js" type="text/javascript" charset="utf-8"></script>
		<!---->
		<script type="text/javascript" src="../../js/utils/vconsole.min.js"></script>
		<script src='../../js/libs/crypto-js/require.js'></script>
		<script src='../../js/utils/signHmacSHA1.js'></script>
		<script src='../../js/libs/jquery.js'></script>
		<script src="../../js/publicProtocolNew.js"></script>
		<script src='../../js/utils/sortSign.js'></script>
		<script src="../../js/storageKeyName.js"></script>
		<script src="../../js/utils/store.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/utils/utils.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/utils/storageutil.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/utils/events.js"></script>
		<script type="text/javascript">
			mui.init();
			var personal;
			var publicParameter;
			mui.plusReady(function() {
				//获取个人信息
				personal = store.get(window.storageKeyName.PERSONALINFO);
				console.log('personal:' + JSON.stringify(personal));
				publicParameter = store.get(window.storageKeyName.PUBLICPARAMETER);
				//4.1.用户已订购套餐及功能扩展栏目
				getUserBusFunc();
				userBusData.peopleMsg = personal;
			});

			function copyObj(obj) {
				let res = {}
				for(var key in obj) {
					res[key] = obj[key]
				}
				return res
			}

			var userBusData = new Vue({
				el: '#userBusData',
				data: {
					orderList: [], //已订购的套餐
					userStuList: [], //关联的学生列表
					peopleMsg: {}
				},
				methods: {
					sureFunc: function() {
						console.log('userBusData.orderList:' + JSON.stringify(userBusData.orderList));
						//						for(var i = 0; i < userBusData.orderList.length; i++) {
						//							var tempStuModel = userBusData.orderList[i];
						//							for(var a = 0; a < tempStuModel.stuList.length; a++) {
						//								var tempModel = tempStuModel.stuList[a];
						//								console.log('tempModel:' + tempModel.selectStu);
						//							}
						//						}
					},
					clickStu: function(userBusModel, stuModel) {
						if(stuModel.selectStu == 0) {
							for(var i = 0; i < userBusModel.stuList.length; i++) {
								var tempUserModel = userBusModel.stuList[i];
								console.log('tempUserModel.selectStu:' + tempUserModel.selectStu);
								console.log('stuModel.selectStu:' + stuModel.selectStu);
								if(tempUserModel.stuid == stuModel.stuid) {
									tempUserModel.selectStu = 1;
								} else {
									tempUserModel.selectStu = 0;
								}
							}
						} else {
							stuModel.selectStu = 0;
						}
						console.log('userBusData.orderList11:' + JSON.stringify(userBusData.orderList));
					}
				}
			});

			//4.1.用户已订购套餐及功能扩展栏目
			function getUserBusFunc() {
				var enData1 = {};
				//不需要加密的数据
				var comData1 = {
					uuid: publicParameter.uuid, //用户设备号
					uid: personal.uid, //用户账号
					utoken: personal.utoken, //用户令牌
					appid: publicParameter.appid //系统所分配的应用ID
				};
				events.showWaiting();
				//获取验证码
				//发送网络请求，data为网络返回值
				postDataEncry('GetUserBusFunc', enData1, comData1, 0, function(data1) {
					console.log('GetUserBusFunc:' + JSON.stringify(data1));
					events.closeWaiting();
					if(data1.RspCode == 0) {
						if(data1.RspData) {
							for(var i = 0; i < data1.RspData.userbus.length; i++) {
								var tempModel = data1.RspData.userbus[i];
								tempModel.stuList = [];
							}
							userBusData.orderList = [].concat(data1.RspData.userbus);
						}
						//4.6.获取用户手机关联的学生列表
						getUserMstu();
					} else {
						mui.toast(data1.RspTxt);
					}
				});
			}

			//4.6.获取用户手机关联的学生列表
			function getUserMstu() {
				var enData1 = {};
				//不需要加密的数据
				var comData1 = {
					uuid: publicParameter.uuid, //用户设备号
					uid: personal.uid, //用户账号
					utoken: personal.utoken, //用户令牌
					appid: publicParameter.appid //系统所分配的应用ID
				};
				events.showWaiting();
				//获取验证码
				//发送网络请求，data为网络返回值
				postDataEncry('UserMstu', enData1, comData1, 0, function(data1) {
					console.log('UserMstu:' + JSON.stringify(data1));
					events.closeWaiting();
					if(data1.RspCode == 0) {
						if(data1.RspData.stus) {
							for(var i = 0; i < data1.RspData.stus.length; i++) {
								var tempStuModel = data1.RspData.stus[i];
								tempStuModel.selectStu = 0;
								if(tempStuModel.sex == 0) {
									tempStuModel.sexName = '女';
								} else {
									tempStuModel.sexName = '男';
								}
							}
							userBusData.userStuList = [].concat(data1.RspData.stus);
							//塞入每个套餐中
							for(var i = 0; i < userBusData.orderList.length; i++) {
								var tempArray = data1.RspData.stus.concat();
								var tempModel = userBusData.orderList[i];
								//vue深拷贝
								tempModel.stuList = JSON.parse(JSON.stringify(tempArray));
							}
						}
					} else {
						mui.toast(data1.RspTxt);
					}
				});
			}
		</script>
	</body>

</html>