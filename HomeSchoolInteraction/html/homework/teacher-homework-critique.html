<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>作业点评</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../css/mui.picker.min.css" />
		<link rel="stylesheet" type="text/css" href="../../css/mui.poppicker.css" />
		<style type="text/css">
			body{
				background: #fff;
			}
			[v-cloak] {
				visibility: hidden;
			}
			.user-title {
				font-size: 17px;
				color: #333333;
				font-weight: bold;
			}
			
			.user-title-body {
				font-size: 15px;
				text-align: left;
				margin: 0 10px;
				color: #3E4B53;
				text-indent: 2em;
			}
			.line{
				background-color: #f2f3f5;
				height: 10px;
				margin-top: 10px;
			}
			
			.title {
				margin:10px 0 10px;
			    color: #FF9933;
			    font-size: 15px;
			    background: #F2F2F2;
			    padding: 5px 15px;
			}
			
			.mui-table-view:after {
			    height: 0px;
			}
			.zt{
			    font-size: 15px;
			    text-align: left;
			    margin: 0 15px;
			    color: #3E4B53;
			    float: left;
			}
			.zt-btn{
				float: right;
				right: 15px;
				margin-top: -5px;
				background-color: #00CFBD;
				border-color:#00CFBD ;
			}
			input[type=text]{
				margin: 0px;
				border: 0;
				font-size: 15px;
			    color: #3E4B53;
			}
			textarea::-webkit-input-placeholder,input::-webkit-input-placeholder {
	        	font-size: 14px;
     		}
			textarea{
				margin: 0px 3% 20px;
				width: 94%;
			}
			
			.bottom-btn{
				position: fixed;
				bottom: 0;
				width: 100%;
				height: 55px;
				 background: #F2F2F2;
				 padding: 10px 15px;
			}
			.bottom-btn-left{
				background-color: #00CFBD;
				border-color:#00CFBD ;
				float: left;
				 width: 40%;
			}
			.bottom-btn-right{
				background-color: #00CFBD;
				border-color:#00CFBD ;
				float: right;
				 width: 40%;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="background-color:#00CFBD;" id="tempVue">
			<a onclick="mui.back()" class="mui-icon mui-icon-left-nav mui-pull-left" style="color: white;"></a>
			<h1 class="mui-title" style="color: white;">作业点评</h1>
			<a v-if="headFlag ==0" class="mui-pull-right" style="color: white;font-size: 15px;margin-top: 10px;" onclick="submit()">提交</a>
		</header>
		<div class="mui-content" style="background: white;">
			<div id="detail">
				<div class="mui-row">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell mui-media">
							<a href="javascript:;">
								<img class="mui-media-object mui-pull-left" :src=homeworkItem.studentImg>
								<div class="mui-media-body">
									{{homeworkItem.studentName}}
									<p class='mui-ellipsis' >{{homeworkItem.grdname}}{{homeworkItem.clsname}}</p>
								</div>
							</a>
						</li>
					</ul>
				</div>
				<div class="title">
					学生答案
				</div>
				<div class="mui-row">
					<p v-cloak class="user-title-body">
						{{homeworkItem.content}}
					</p>
				</div>
				<div class="title">
						递交状态
					</div>
				<div class="mui-row">
					<div style="padding: 10px 0;">
						<p v-cloak class="zt">{{homeworkItem.submitStatusTxt}}</p>
						<template v-if="homeworkItem.correctStatus==0">
							<template v-if="homeworkItem.submitStatus==0">
								<button class="mui-btn mui-btn-primary zt-btn" @tap="changeStates()">登记状态</button>
							</template>
							<template v-else>
								<button class="mui-btn mui-btn-primary zt-btn" @tap="changeStates()">修改状态</button>
							</template>
						</template>
					</div>
				</div>
				<div class="title">
						分数
				</div>
				<div class="mui-row">
					<input name="score" v-model=score type="text" placeholder="请输入分数（0-100）"  onkeyup="clearNoNum(this)">
				</div>
				<div class="title">
						输入评价
				</div>
				<div class="mui-row">
					<textarea name="critique" v-model=comment rows="5" placeholder="请输入评价" style="margin-bottom: 60px;"></textarea>
				</div>
				
				<div class="bottom-btn">
					<button class="mui-btn mui-btn-primary bottom-btn-left" @tap="previous()" >上一个</button>
					<button class="mui-btn mui-btn-primary bottom-btn-right" @tap="next()">下一个</button>
				</div>
			</div>
		</div>
		<script src="../../js/slide/mui.min.js"></script>
		<script src="../../js/utils/store.js"></script>
		<script src="../../js/utils/vue.min.js"></script>
		<script src="../../js/utils/utils.js"></script>
		<script src="../../js/utils/events.js"></script>
		<script src="../../js/libs/jquery.js"></script>
		<script src="../../js/publicProtocolNew.js"></script>
		<script src="../../js/utils/vconsole.min.js"></script>
		<script src="../../js/mui/mui.picker.js"></script>
		<script src="../../js/mui/mui.poppicker.js"></script>
		<script src="../../js/publicProtocol-studentManage.js"></script>
		<script type="text/javascript">
			var curPage=[];//curPage是个数组，里面放了三个对象，0 ：整个班的已批未批作业数组，1：已批未批作业单项，点击列表进来的列表项 2上交登记数组
			mui.init({
				swipeBack: false
			});
			mui.plusReady(function() {
				curPage = utils.getDataFromUrl(window.location.href);
				console.log(JSON.stringify(curPage[0]))
				console.log(JSON.stringify(curPage[1]))
				console.log(JSON.stringify(curPage[2]))
				
				var detail = new Vue({
					el: "#detail",
					data: {
						homeworkList:curPage[0],//已批未批作业数组
						homeworkItem:curPage[1],//已批未批作业单项，点击列表进来的列表项
						submitArray:curPage[2],//上交登记数组
						score:'',//分数
						comment:'',//评价
						submitStatus:0//登记状态
					},
					methods: {
						previous:function(){
							console.log("123")
							//TODO 判断当前作业是否有修改,有修改提示，无修改再切换
						},
						next:function(){
							console.log("456")
							//TODO 判断当前作业是否有修改,有修改提示，无修改再切换
						},
						changeStates:function(){//修改状态
							//普通示例
							var statePicker = new mui.PopPicker();
							statePicker.setData(this.submitArray);
							statePicker.show(function(items) {
								detail.submitStatus=items[0].value;
								console.log(JSON.stringify(items));
							});
						}
					}
				});
				
				var homeworkItem=curPage[1];
				if(homeworkItem.score!=''){
					detail.score=homeworkItem.score;
				}
				if(homeworkItem.comment!=''){
					detail.comment=homeworkItem.comment;
				}
				detail.submitStatus=homeworkItem.submitStatus;
			});
			
			//提交作业点评
			function submit(){
				if(detail.submitStatus==0){
					mui.toast('请先登记状态');
					return 0;
				}
				//TODO 判断当前作业是否有修改,有修改在提交
//				var comData ={
//					id:homeworkDetail.id,//作业id
//					score:detail.score,//分数
//					comment:detail.comment//评价
//				};
//				console.log('comData=='+JSON.stringify(comData));
//				var wd = events.showWaiting();
//				hwTeacherorrectHomework(comData, function(data) {
//					wd.close();
//					if(data.RspCode == 0) {
//						mui.toast(data.msg);
//					} else {
//						mui.toast(data.msg);
//					}
//				});
			}
			
			
			function submitZT(){//修改状态提交
				var students=detail.submitStatus;
				var comData ={
					homeworkId:homeworkDetail.id,//作业id
					ids:homeworkDetail.studentId,//学生ID
					submitStatus:status//提交状态
				};
				console.log('comData=='+JSON.stringify(comData));
				var wd = events.showWaiting();
				hwTeacheratchCheckIn(comData, function(data) {
					wd.close();
					if(data.RspCode == 0) {
						mui.toast(data.msg);
					} else {
						mui.toast(data.msg);
					}
				});
			}
			
			//只保留小数点后一位
			function clearNoNum(obj){ 
			    obj.value = obj.value.replace(/[^\d.]/g,"");  //清除“数字”和“.”以外的字符  
			    obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个. 清除多余的  
			    obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$","."); 
			    obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d).*$/,'$1$2.$3');//只能输入两个小数  
			    if(obj.value.indexOf(".")< 0 && obj.value !=""){//以上已经过滤，此处控制的是如果没有小数点，首位不能为类似于 01、02的金额 
			        obj.value= parseFloat(obj.value); 
			    } 
			} 
		</script>
	</body>

</html>
