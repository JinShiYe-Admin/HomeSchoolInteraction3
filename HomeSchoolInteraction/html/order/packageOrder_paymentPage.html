<!DOCTYPE html>
<html>
	<!-- 套餐订购 支付页 -->

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../css/mui.min.css">
		<style type="text/css">
			[v-cloak] {
				visibility: hidden;
			}
			
			body {
				background: #F2F2F2;
			}
			
			.mui-row {
				background: #FFF;
			}
			
			.mui-table-view .mui-media-object {
				max-width: 100px;
			}
			
			.mui-table-view .mui-media-object.mui-pull-left {
				margin-right: 5px;
			}
			
			.mui-ellipsis-title {
				font-size: 18px;
				color: #000;
				overflow: hidden;
				word-break: break-all;
				display: -webkit-box;
				-webkit-line-clamp: 2;
				-webkit-box-orient: vertical;
				white-space: normal;
			}
			
			.mui-ellipsis {
				margin: 5px 0 0 0;
				height: 43px;
				overflow: hidden;
				word-break: break-all;
				display: -webkit-box;
				-webkit-line-clamp: 2;
				-webkit-box-orient: vertical;
				white-space: normal;
			}
			
			.ul-btn {
				display: inline;
				vertical-align: middle;
				float: right;
				height: 24px;
				padding: 2px 12px;
				background: #33CCFF;
				color: #fff;
				border: none;
			}
			
			.ul-p {
				width: 30%;
				display: inline;
				vertical-align: middle;
				font-size: 12px;
			}
			
			a {
				text-decoration: none;
				color: #000000;
			}
			
			.mui-content-padded {
				margin: 10px 10px 10px 16px;
			}
			
			select {
				color: #8f8f94;
			}
			
			.line:before {
				position: absolute;
				top: 0;
				right: 0;
				left: 15px;
				height: 1px;
				content: '';
				-webkit-transform: scaleY(.2);
				transform: scaleY(.2);
				background-color: #c8c7cc;
			}
			
			.wxImg {
				width: 30px;
			}
			
			.mui-checkbox input[type=checkbox]:before,
			.mui-radio input[type=radio]:before {
				font-size: 25px;
			}
			
			.check {
				text-align: left;
				font-size: 15px;
				margin: 10px 0 100px 5%;
			}
			
			.bottom-row {
				position: fixed;
				bottom: 0;
				z-index: 3;
				background: #FFFFFF;
				width: 100%;
				height: 50px;
			}
			
			.pay-btn-je {
				height: 50px;
				border: 0px;
				text-align: left;
			}
			
			.pay-btn {
				border: #00CFBD;
				background: #00CFBD;
				height: 50px;
				border-radius: 0;
			}
			
			input::-webkit-input-placeholder {
				color: #8f8f94;
			}
			
			.spanCheck {
				width: 65%;
			}
			/*弹出层样式*/
			
			#topPopover {
				position: fixed;
				top: 16px;
				right: 6px;
			}
			
			#topPopover .mui-popover-arrow {
				left: auto;
				right: 6px;
			}
			
			.mui-popover {
				height: 300px;
			}
			
			.mui-checkbox input[type=checkbox]:checked:before {
				color: #00cfbd;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="background-color:#00CFBD;">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color:#ffffff"></a>
			<h1 class="mui-title" style="color: white;">套餐订购</h1>
		</header>
		<div class="mui-content">
			<div id='orderDetail'>
				<div class="mui-row">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell mui-media">
							<a href="javascript:;">
								<img class="mui-media-object mui-pull-left" v-cloak :src=orderDetail.imgUrl style="width: 90px;height:90px;">
								<div class="mui-media-body">
									<p class='mui-ellipsis-title' v-cloak>{{orderDetail.cnname}}</p>
									<p class='mui-ellipsis' v-cloak>{{orderDetail.busnote}}</p>
								</div>
								<div style="margin-top: 5px;" v-cloak>
									<p class="ul-p" style="color:#FF6600">缴费金额：{{orderDetail.feecode}}元/{{orderDetail.busmonth}}月</p>
								</div>
							</a>
						</li>
					</ul>
				</div>
			</div>
			<div id='orderData'>
				<form id="orderForm">
					<div class="mui-row" style="margin-top: 5px;" v-for="sysfuncModel in sysfuncList">
						<h5 class="mui-content-padded">功能1附加信息</h5>
						<div class="mui-input-row line" v-for="fextModel in sysfuncModel.fext">
							<a class="mui-navigate-right">
								<label>{{fextModel.itemname}}</label>
								<a :href="'#'+sysfuncModel.fid+fextModel.itemcode">
									<input :id="sysfuncModel.fid+fextModel.itemcode+'input0'" type="button" name="" :value="'请选择'+fextModel.itemname" style="width: 50%;color: #8f8f94;border:0;margin-top: 5px;" />
									<input :id="sysfuncModel.fid+fextModel.itemcode+'input1'" type="hidden" name="sysfuncList" />
								</a>
							</a>
						</div>
					</div>

					<div class="mui-row" style="margin-top: 5px;">
						<div class="mui-input-row" style="margin-top: 5px;">
							<a class="mui-navigate-right">
								<label>时长</label>
								<select name="" class="mui-btn-block">
									<option value="" disabled selected>请选择时长</option>
									<option value="1">1个月</option>
									<option value="3">3个月</option>
									<option value="6">半年</option>
									<option value="12">一整年</option>
								</select>
							</a>
						</div>
						<div class="mui-input-row line">
							<label style="text-align: right; font-size: 15px;color: #666666;width: 100%;">缴费金额：<span id="zfje-1">0</span>元</label>
						</div>
					</div>

					<div class="mui-row" style="margin-top: 5px;">
						<h5 class="mui-content-padded">请选择支付方式</h5>
						<div class="mui-input-row mui-radio line" @click="radioClick">
							<label style="width: 100%;">
									<img src="../../img/homeSchool/wxpay.png" class="wxImg" style="vertical-align: middle;"/>
									<span  style="vertical-align: middle;">微信支付</span>
								</label>
							<input name="" type="radio" style="margin-top: 10px;" :checked="radioChecked">
						</div>
					</div>

					<div class="check">
						<input @click="checkboxClick" id="checkBox" name="" type="checkbox" style="vertical-align:middle;" /><label for="checkBox" style="vertical-align:middle;">我已阅读并接受</label>
						<a style="color: #007aff;vertical-align: middle;" href="javascript:;;">《注册协议》</a>
					</div>

				</form>
				<div class="mui-row bottom-row">
					<button class="mui-col-xs-8 mui-col-sm-8 pay-btn-je">
	    				¥&ensp;<span id="zfje-2" style="color: #FF6600; font-size: 20px;">0</span>元
	    				<span id="zffs" style="font-size:10px;color: #8f8f94;">&ensp;|&ensp;微信支付</span>
	    			</button>
					<button class="mui-btn mui-btn-primary mui-col-xs-4 mui-col-sm-4 pay-btn" :disabled="isDisabled">确认支付</button>
				</div>

				<!--用户类型多选列表-->
				<div v-for="sysfuncModel in sysfuncList">
					<div v-for="fextModel in sysfuncModel.fext">
						<div :id="sysfuncModel.fid+fextModel.itemcode" class="mui-popover">
							<div class="mui-popover-arrow"></div>
							<div class="mui-scroll-wrapper" style="margin: 7px 0 45px 0;">
								<div class="mui-scroll">
									<form>
										<ul class="mui-table-view" :maxCheck=fextModel.itemsonsc>
											<li class="mui-table-view-cell" style="padding: 0;" v-for="(item,index) in fextModel.itemsons">
												<div class="mui-input-row mui-checkbox mui-right">
													<label>{{item}}</label>
													<input :name=index :value=item type="checkbox">
												</div>
											</li>
										</ul>
									</form>
								</div>
							</div>
							<div class="mui-input-row" style="height:37px;top:263px;border-radius: 3px;z-index: 20180704;background: #F7F7F7;">
								<button class="mui-btn mui-btn-primary" style="width: 25%;background: #00CFBD;border: 0px;" onclick="hidePop(this)">确定</button>
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
		<script type="text/javascript" src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/utils/vue.js"></script>
		<!--加密-->
		<script src="../../js/libs/RSA/Barrett.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/libs/RSA/BigInt.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/libs/RSA/RSA.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/utils/RSAEncrypt.js" type="text/javascript" charset="utf-8"></script>
		<!---->
		<script type="text/javascript" src="../../js/utils/vconsole.min.js"></script>
		<script src='../../js/libs/crypto-js/require.js'></script>
		<script src='../../js/utils/signHmacSHA1.js'></script>
		<script src='../../js/libs/jquery.js'></script>
		<script src="../../js/publicProtocolNew.js"></script>
		<script src='../../js/utils/sortSign.js'></script>
		<script src="../../js/storageKeyName.js"></script>
		<script src="../../js/utils/store.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/utils/utils.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/utils/storageutil.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/utils/events.js"></script>
		<script>
			var personal = store.get(window.storageKeyName.PERSONALINFO);
			console.log('personal********:' + JSON.stringify(personal));
			var publicParameter = store.get(window.storageKeyName.PUBLICPARAMETER);
			mui.init();

			var curPageData;
			var orderDetail;
			var orderData;
			mui.plusReady(function() {
				orderDetail.orderDetail = utils.getDataFromUrl(window.location.href);
				orderDetail.orderDetail.imgUrl = '../../img/login/headImg.png';
				//套餐功能及扩展栏目
				getSysBusFunc();
			});

			var orderDetail = new Vue({
				el: '#orderDetail',
				data: {
					orderDetail: {}
				}
			});

			var orderData = new Vue({
				el: '#orderData',
				data: {
					radioChecked: false,
					chekcboxChecked: false,
					isDisabled: true,
					sysfuncList: [], //附加信息
					xd: {} //测试
				},
				methods: {
					radioClick: function() {
						this.radioChecked = !this.radioChecked
						if(this.radioChecked == false)
							this.isDisabled = true
						else if(this.radioChecked == true && this.chekcboxChecked == true)
							this.isDisabled = false
					},
					checkboxClick: function() {
						this.chekcboxChecked = !this.chekcboxChecked
						if(this.chekcboxChecked == false)
							this.isDisabled = true
						else if(this.chekcboxChecked == true && this.radioChecked == true)
							this.isDisabled = false
					}
				}
			});

			//套餐功能及扩展栏目
			var getSysBusFunc = function() {
				var enData1 = {};
				//不需要加密的数据
				var comData1 = {
					uuid: publicParameter.uuid, //用户设备号
					fcodes: orderDetail.orderDetail.fcodes, //功能代码串,留空为全部,多个用逗号隔开
					utoken: personal.utoken, //用户令牌
					appid: publicParameter.appid //系统所分配的应用ID
				};
				events.showWaiting();
				//获取验证码
				//发送网络请求，data为网络返回值
				postDataEncry('SysBusFunc', enData1, comData1, 0, function(data1) {
					console.log('SysBusFunc:' + JSON.stringify(data1));
					events.closeWaiting();
					if(data1.RspCode == 0) {
						//将sysfunc[0].fext[0].itemsons转化为数组
						for(var i = 0; i < data1.RspData.sysfunc.length; i++) {
							var tempModel0 = data1.RspData.sysfunc[i];
							for(var a = 0; a < tempModel0.fext.length; a++) {
								var tempModel1 = tempModel0.fext[a];
								tempModel1.itemsons = tempModel1.itemsons.split(',');
							}
						}
						orderData.sysfuncList = [].concat(data1.RspData.sysfunc);
					} else {
						mui.toast(data1.RspTxt);
					}
				});
			}

			//隐藏弹出层
			function hidePop(domDiv) {
				//				var params = $(domDiv).parent().parent().find('form').serializeObject();
				//				console.log(JSON.stringify(params));
				//遍历已勾选的input的key 和value
				var name = [];
				var value = [];
				var max = $(domDiv).parent().parent().find('ul').attr('maxCheck');
				$(domDiv).parent().parent().find('li').each(function() {
					if($(this).find('input').prop("checked")) {
						name.push($(this).find('label').text());
						value.push($(this).find('input').val());
					}
				})
				if(value.length > max) {
					mui.toast('最多选' + max + '个');
					return;
				}
				var id = $(domDiv).parent().parent().attr("id");
				document.getElementById(id + 'input0').value = name;
				document.getElementById(id + 'input1').value = value;
				mui('#' + id).popover('toggle');
			}

			//将输入表单中的内容，转为obj
			$.fn.serializeObject = function() {
				var o = {};
				var a = this.serializeArray();
				$.each(a, function() {
					if(o[this.name] !== undefined) {
						if(!o[this.name].push) {
							o[this.name] = [o[this.name]];
						}
						o[this.name].push(this.value || '');
					} else {
						o[this.name] = this.value || '';
					}
				});
				return o;
			};

			mui('.mui-scroll-wrapper').scroll();
			//			mui('body').on('shown', '.mui-popover', function(e) {
			//				console.log('shown', e.detail.id);//detail为当前popover元素
			//			});
			//			mui('body').on('hidden', '.mui-popover', function(e) {
			//				console.log('hidden', e.detail.id);//detail为当前popover元素
			//				
			//			});
		</script>
	</body>

</html>